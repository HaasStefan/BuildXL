# Sets pipeline variables with appropriate PATs to use as environment variables in internal selfhost builds 
# Note this task assumes the variable group "BuildXL Secrets" is available
parameters:
- name: workingDirectory
  type: string
  default: $(Build.SourcesDirectory)

steps:
- template: /.azdo/common/generate-access-token.yml
  parameters:
    AccessTokenVariable: BuildXL-Pipeline-AccessToken

- task: PowerShell@2
  displayName: Set environment variables for the job with necessary access tokens
  inputs:
    workingDirectory: ${{ parameters.workingDirectory }}
    targetType: filePath
    filePath: .azdo/scripts/SetVariablePats.ps1
    arguments: >-
      -OneEsPat    $(BuildXL-Pipeline-AccessToken)
      -CbPat       $(BuildXL-Pipeline-AccessToken)
      -MsEngGitPat $(PAT-TseBuild-AzureDevOps-MsEng-ReadCode)
      -VstsPat     $(System.AccessToken)